{{#section "signupcss"}}
<link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.20/jquery.datetimepicker.min.css">
{{/section}}

{{#section "signupjs"}}
<script>
    // Fetch user info from the server
    fetch('/account/user-info')
        .then(function (response) {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(function (data) {
            if (data.success) {
                // Process the data and populate the form fields
                document.getElementById('txtUsername').value = data.user.username;
                document.getElementById('txtEmail').value = data.user.email;
                document.getElementById('txtNoOfFollower').value = data.user.NoOfFollower;
                document.getElementById('txtNoOfFollowing').value = data.user.NoOfFollowing;

                // Convert dob to yyyy-mm-dd format for the input field
                const dob = new Date(data.user.dob);
                const dobFormatted = dob.toLocaleDateString('en-CA');
                document.getElementById('txtDOB').value = dobFormatted;

                // Set role name based on permission
                document.getElementById('txtRole').value = data.roleName;
            } else {
                alert('Không thể tải thông tin người dùng.');
            }
        })
        .catch(function (error) {
            console.error('Error:', error);
        });
</script>
{{/section}}

<div id="card-contain" class="card">
    <div id="signup-card" class="card-body">
        <div class="d-flex flex-column justify-content-center align-items-center">
            <img id="logo-img" src="/static/imgs/NEWSLANDlogoRmBg.png" alt="" class="img-fluid rounded-circle">
            <h1>Thông tin người dùng</h1>
        </div>
        <div id="card-btn-connect" class="card-body d-flex flex-column justify-content-center align-items-center">
            <form id="fmUpdate" action="/account/update" method="post">
                <div class="mb-2 form-group">
                    <label class="form-label" for="txtUsername">Tên tài khoản</label>
                    <input type="text" name="username" id="txtUsername" class="form-control txt-input" value="{{username}}" required>
                </div>
                <div class="mb-2 form-group">
                    <label class="form-label" for="txtEmail">Email</label>
                    <input type="email" name="email" id="txtEmail" class="form-control txt-input" value="{{email}}" required>
                </div>
                <div class="mb-2 form-group">
                    <label class="form-label" for="txtRole">Vai trò</label>
                    <input type="text" name="role" id="txtRole" class="form-control txt-input" value="{{permissionName}}" readonly>
                </div>
                <div class="mb-2 form-group">
                    <label class="form-label" for="txtDOB">Ngày sinh</label>
                    <input type="date" name="dob" id="txtDOB" class="form-control txt-input" value="{{dob}}" required>
                </div>
                <div class="mb-2 form-group">
                    <label class="form-label" for="txtPassword">Mật khẩu</label>
                    <input type="password" name="password" id="txtPassword" class="form-control txt-input" value="{{password}}" readonly>
                    <a href="/account/reset-password" class="btn btn-warning d-flex justify-content-between w-50">Đổi mật khẩu</a> <!-- Change Password button -->
                </div>
                <div class="d-flex justify-content-between w-100">
                    <button type="submit" class="btn btn-info btn-connect mb-3">Cập nhật</button>
                </div>
                <div class="d-flex justify-content-between w-100">
                    <a href="http://localhost:3000/subscriber" class="btn btn-connect mb-3">Hủy</a> <!-- Cancel button -->
                </div>
            </form>
        </div>
    </div>
</div>